# 自定义测试功能说明

## 功能概述

自定义测试模块允许用户创建自己的题目，上传图片，设置选项，并进行测试。所有数据保存在本地浏览器存储中，与设备绑定。

## 主要功能

### 1. 题目管理 (`/custom-quiz/manage`)

- **查看题目列表**：显示所有已创建的自定义题目
- **创建新题目**：跳转到创建页面
- **删除题目**：删除不需要的题目（需要二次确认）
- **开始测试**：对所有自定义题目进行测试
- **统计信息**：显示题目总数、总分值、存储空间占用

### 2. 创建题目 (`/custom-quiz/create`)

#### 创建流程

1. **上传图片**
   - 支持拍照或从相册选择
   - 支持 JPG、PNG 格式
   - 最大文件大小：10MB
   - 自动压缩到 800px 宽度
   - 图片质量：80%

2. **输入题目问题**
   - 最多 100 个字符
   - 例如："这是什么化妆品？"

3. **设置四个选项**
   - 固定 A、B、C、D 四个选项
   - 每个选项最多 50 个字符
   - 必须选择一个正确答案

4. **保存题目**
   - 验证所有字段已填写
   - 保存到本地存储
   - 自动跳转到管理页面

#### 数据结构

```typescript
interface CustomQuestion {
  id: string              // 唯一ID（时间戳+随机数）
  image: string           // base64编码的图片
  question: string        // 题目问题
  options: [string, string, string, string]  // 四个选项
  correctAnswer: number   // 正确答案索引（0-3）
  createdAt: number       // 创建时间戳
}
```

### 3. 测试模式 (`/custom-quiz/test`)

#### 测试流程

1. **加载题目**：从本地存储读取所有自定义题目
2. **答题**：逐题显示，选择答案后显示正确/错误
3. **查看结果**：
   - 显示总分（每题10分）
   - 显示答对题数
   - 显示详细答题情况
   - 可以重新测试

#### 评分规则

- 每题 10 分
- 总分 = (答对题数 / 总题数) × 100
- 评价标准：
  - 90分以上：太棒了！
  - 70-89分：不错！
  - 60-69分：还可以
  - 60分以下：需要更多练习

## 技术实现

### 本地存储

使用浏览器的 `localStorage` API 存储数据：

- **存储键**：`cosmetics_custom_questions`
- **数据格式**：JSON 字符串
- **设备绑定**：数据存储在浏览器本地，不同设备/浏览器数据独立

### 图片处理

1. **读取文件**：使用 `FileReader` API
2. **压缩图片**：
   - 创建 Canvas 元素
   - 按比例缩放到最大 800px 宽度
   - 转换为 JPEG 格式，质量 80%
   - 输出 base64 编码

### 工具函数

位于 [`src/utils/customQuestions.ts`](../cosmetics-quiz/src/utils/customQuestions.ts)：

- `generateId()`: 生成唯一ID
- `getCustomQuestions()`: 获取所有题目
- `saveCustomQuestion()`: 保存新题目
- `deleteCustomQuestion()`: 删除题目
- `updateCustomQuestion()`: 更新题目
- `clearCustomQuestions()`: 清空所有题目
- `compressImage()`: 压缩图片

## 页面路由

| 路由 | 页面 | 说明 |
|------|------|------|
| `/custom-quiz/manage` | 题目管理 | 查看、删除题目，开始测试 |
| `/custom-quiz/create` | 创建题目 | 上传图片，设置题目和选项 |
| `/custom-quiz/test` | 开始测试 | 对自定义题目进行测试 |

## 使用限制

### 存储限制

- **localStorage 容量**：通常为 5-10MB
- **题目数量上限**：20 题（硬性限制）
- **单张图片大小**：压缩后约 50-200KB

### 浏览器兼容性

- 需要支持 `localStorage`
- 需要支持 `FileReader` API
- 需要支持 `Canvas` API
- 建议使用现代浏览器（Chrome、Safari、Firefox、Edge）

### 数据持久性

- 数据存储在浏览器本地
- 清除浏览器数据会删除所有题目
- 不同设备/浏览器数据不同步
- 建议定期备份重要题目（可截图保存）

## 用户体验优化

### 视觉反馈

- 上传图片时显示加载动画
- 保存题目时显示保存中状态
- 删除题目需要二次确认
- 答题后立即显示正确/错误

### 表单验证

- 实时显示字符计数
- 未填写完整时禁用保存按钮
- 显示当前选择的正确答案
- 图片大小和格式验证

### 响应式设计

- 支持手机、平板、电脑
- 自适应布局
- 触摸友好的按钮大小
- 移动端优化的拍照功能

## 未来扩展

可能的功能扩展：

1. **题目编辑**：允许修改已创建的题目
2. **题目分类**：按类别组织题目
3. **导入导出**：支持题目的备份和恢复
4. **题目分享**：生成分享链接
5. **云端同步**：跨设备同步题目
6. **批量操作**：批量删除、批量导出

## 故障排除

### 常见问题

1. **图片上传失败**
   - 检查文件格式（仅支持图片）
   - 检查文件大小（最大10MB）
   - 尝试使用其他图片

2. **保存失败**
   - 检查存储空间是否已满
   - 清除浏览器缓存后重试
   - 减少图片数量

3. **题目丢失**
   - 检查是否清除了浏览器数据
   - 确认使用的是同一设备和浏览器
   - 检查是否使用了隐私/无痕模式

4. **测试无法开始**
   - 确认已创建至少一道题目
   - 刷新页面重试
   - 检查浏览器控制台错误信息

## 开发说明

### 文件结构

```
cosmetics-quiz/
├── src/
│   ├── app/
│   │   └── custom-quiz/
│   │       ├── manage/
│   │       │   └── page.tsx      # 题目管理页面
│   │       ├── create/
│   │       │   └── page.tsx      # 创建题目页面
│   │       └── test/
│   │           └── page.tsx      # 测试页面
│   ├── types/
│   │   └── question.ts           # 类型定义
│   └── utils/
│       └── customQuestions.ts    # 工具函数
```

### 依赖项

- Next.js 15+
- React 19+
- TypeScript
- Tailwind CSS

### 本地开发

```bash
cd cosmetics-quiz
npm install
npm run dev
```

访问 `http://localhost:3000/custom-quiz/manage` 查看功能。
